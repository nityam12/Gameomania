const autoscroll=e=>{const t=document.getElementById("chat-messages-list"),s=t.lastElementChild,o=window.getComputedStyle(s),a=parseInt(o.marginBottom),n=s.offsetHeight+a,i=t.offsetHeight;t.scrollHeight-n<=t.scrollTop+i&&(t.scrollTop=t.scrollHeight)};class ChatEngine{constructor(e,t,s,o,a,n){this.chatBox=$("#"+e),this.userEmail=t,this.userName=s,this.id1=o,this.id2=a,this.socket=io.connect("https://hidden-everglades-85411.herokuapp.com:5000"),this.chatBoxId=e,this.chatroom=n,this.userEmail&&this.connectionHandler()}connectionHandler(){let e=this;this.socket.on("connect",(function(){console.log("connection established using sockets...!"),e.socket.emit("join_room",{user_email:e.userEmail,chatroom:e.chatroom,user_name:e.userName,id1:e.id1,id2:e.id2}),e.socket.on("user_joined",(function(e){}))})),$("#send-message").click((function(){const t=$(this),s=$("#chat-message-input").val();$("#chat-message-input").val(""),t.attr("disabled",!0),""!=s?e.socket.emit("send_message",{message:s,user_email:e.userEmail,chatroom:e.chatroom,user_name:e.userName},e=>{t.attr("disabled",!1),$("#chat-message-input").focus(),e&&console.log(e)}):t.attr("disabled",!1)})),e.socket.on("receive_message",(function(t){let s=$("<li>"),o="other-message";t.user_email==e.userEmail&&(o="self-message"),s.append($("<span>",{html:t.text})),s.prepend($("<sup>",{html:t.user_name})),s.append($("<sub>",{html:moment(t.createdAt).format("h:mm a")})),s.addClass(o),$("#chat-messages-list").append(s),autoscroll(e.chatBoxId)}),e=>{e&&console.log(e)}),$("#share-location").click((function(){const t=$(this);if(!navigator.geolocation)return alert("Geolocation is not supported by your browser");function s(e){console.error(`ERROR(${s.code}): ${e.message}`)}function o(s){navigator.geolocation.getCurrentPosition(s=>{e.socket.emit("sendlocation",{latitude:s.coords.latitude,longitude:s.coords.longitude,user_email:e.userEmail,chatroom:e.chatroom,user_name:e.user_name},()=>{t.attr("disabled",!1)})})}t.attr("disabled",!0),navigator.geolocation.getCurrentPosition(o,s)})),e.socket.on("receive_location",(function(t){let s=$("<li>"),o="other-message";t.user_email==e.userEmail&&(o="self-message");const a=$("<a>My Current Location</a>");a.attr("href",t.url),a.attr("target","_blank"),s.append($("<span>",{html:a})),s.prepend($("<sup>",{html:t.user_email})),s.append($("<sub>",{html:moment(t.createdAt).format("h:mm a")})),s.addClass(o),$("#chat-messages-list").append(s),autoscroll(e.chatBoxId)}))}}